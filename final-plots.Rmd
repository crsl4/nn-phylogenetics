# Final plots for ms

First, I downloaded the output csv files from the [Google Drive](https://drive.google.com/drive/u/2/folders/1G_ied9kMbcJTt_ZNWWN67SAkggFISNGT) and put inside a folder `phylo-nn-googledrive/outputs/PlotsData/`: `EpochAccuracy1300.csv`, `SixMethodsComparison.csv`, `trainLoss1300.csv`, `testLoss1300.csv`

## 1. Accuracy plot comparing 6 methods

Reading the csv file:
```{r}
dat = read.csv("phylo-nn-googledrive/outputs/PlotsData/SixMethodsComparison.csv", header=TRUE)
str(dat)
```

Modifying the data:
```{r}
library(tidyr)
df = gather(dat,"method","accuracy",5:10)
df = within(df, method <- factor(method, levels=c("NJ","ML","BI","Zou","LSTM","OptLSTM")))
head(df)
```

Identifying colors:
```{r}
library(viridis)
library(RColorBrewer)
display.brewer.all(colorblindFriendly = TRUE)
```

These are the cases we are doing:
b=0.1, 0.5, 1
a=2b, 10b, 40b
c=0.01b, 0.1b, b

But it seems that the values of a and b have been switched:
```{r}
str(df)
```
So, we switch who is a and who is b in the plot.

Plotting results:
```{r}
library(ggplot2)

p <- ggplot(df, aes(x=log(c), y=accuracy, color=method))+
  geom_point(size=2.5) + geom_line(size=1.25) +
  scale_color_brewer(palette="YlGnBu", type="div") +
  xlab("c") + ylab("Testing accuracy") +
  scale_x_continuous(breaks=log(c(0.01,0.1,1)), labels=c("0.01","0.1","1")) +
      theme(
        plot.title = element_text(hjust=0.5, size=rel(2)),
        axis.title.x = element_text(size=rel(1.8)),
        axis.title.y = element_text(size=rel(1.9), angle=90, vjust=0.5, hjust=0.5),
        axis.text.x = element_text(colour="grey", size=rel(1.7), angle=90, hjust=.5, vjust=.5, face="plain"), 
        axis.text.y = element_text(colour="grey", size=rel(1.7), angle=0, hjust=.5, vjust=.5, face="plain"),
        panel.background = element_rect(fill = NA, color = "black"),
        axis.line = element_line(colour = "grey"),
        strip.text = element_text(size = rel(2)),
        legend.title = element_blank(),
        legend.text = element_text(size = rel(1.5)),
        legend.position = "top"
        ) +
  facet_grid(b ~ a,
             labeller = labeller(
                a = c(`0.1` = "b=0.1", `0.5` = "b=0.5", `1` = "b=1.0"),
                b = c(`2` = "a=2b", `10` = "a=10b", `40` = "a=40b")
             )) +
  guides(colour = guide_legend(nrow = 1))

pdf("plots/6methods-accuracy.pdf",height=7, width=7)
p
dev.off()
```

<!--
Looking at some cases:
```{r}
df[(df$b==10 & df$a==1.0),]
```
-->

## 2. Quartet with a,b,c

```{r}
library(ape)
a = 3
b = 1
c = 0.5
tr = paste0("((1:",b,",2:",a,"):",c,",(3:",a,",4:",b,"):",c,");")
t = read.tree(text=tr)

## need to copy and paste below:
pdf("plots/quartet.pdf",height=5, width=3)
plot(t, type="unrooted", show.tip.label=FALSE, edge.width=3, no.margin=TRUE)
##edgelabels(c("c","b","a","","a","b"), frame="none", adj = c(1.5, -1.5), cex=2)
edgelabels("c",1, bg="white", cex=3, adj = c(0.4, -0.2))
edgelabels(c("b","a","a","b"), c(2,3,5,6),bg="white", cex=3)
dev.off()
     #, rotate.tree=270)
```




### 3D plot for our NN accuracy as in Zou (unable to do it at this point)

We only want to results corresponding to our NN:
```{r}
df2 = df[df$method %in% c("LSTM","OptLSTM"),]
```

Need to install `gg3d`:
```{r}
##devtools::install_github("AckerDWM/gg3D")
## needed to install XQuartz: brew install --cask xquartz
```

Plotting:
```{r}
library(gg3D)
theta=0 
phi=20

p2 <- ggplot(df2, aes(x=a, y=b, z=accuracy, color=method)) +
  axes_3D(theta=theta, phi=phi) +
  stat_3D(theta=theta, phi=phi, geom="path") +
  axis_labs_3D(theta=theta, phi=phi, size=3, 
               hjust=c(1,1,1.2,1.2,1.2,1.2), 
               vjust=c(-.5,-.5,-.2,-.2,1.2,1.2)) +
  labs_3D(theta=theta, phi=phi, 
          hjust=c(1,0,0), vjust=c(1.5,1,-.2),
          labs=c("b", "a", "Testing accuracy")) + ##note a->b, b->a
  theme_void()


library(lattice)
wireframe(accuracy ~ a * b, data=df2)

dff = df2[df2$method == "LSTM",]

df3 = dff %>% group_by(a,b) %>% summarise(mean(accuracy))

library(plotly)
plot_ly(x=dff$z,y=dff$b,z=dff$accuracy, type="surface")
```

## 3. Training epochs

Color palettes
```{r}
library(ggplot2)
library(viridis)
library(RColorBrewer)
cbp1 <- c("#999999", "#E69F00", "#56B4E9", "#009E73",
          "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
display.brewer.all(colorblindFriendly = TRUE)
```

### Loss dynamics

Reading the csv file:
```{r}
dat2 = read.csv("phylo-nn-googledrive/outputs/PlotsData/testLoss1300.csv", header=FALSE)
dat3 = read.csv("phylo-nn-googledrive/outputs/PlotsData/trainLoss1300.csv", header=FALSE)
str(dat2)
str(dat3)
```

We have 1300 rows for training loss, but we only want 130 so that it match the testing loss. For the testing loss, we have testing loss every 10 epochs, but for the training loss we have for every single epoch.
```{r}
dat3.2 = dat3[dat3$V1 %% 10 == 0,]
```

Need to append all loss data:
```{r}
dat2$type = "testing"
dat3.2$type = "training"

dat = rbind(dat2,dat3.2)
str(dat)
```

```{r}
p = ggplot(dat, aes(x=V1,y=V2, color=type))+
  geom_line(size=1) + 
    scale_color_brewer(palette="Paired") +
  xlab("Epoch") + ylab("Loss")+
  theme(
    plot.title = element_text(hjust=0.5, size=rel(1.6)),
    axis.title.x = element_text(size=rel(1.7)),
    axis.title.y = element_text(size=rel(1.7), angle=90, vjust=0.5, hjust=0.5),
    axis.text.x = element_text(colour="grey", size=rel(1.6), angle=0, hjust=.5, vjust=.5, face="plain"),
    axis.text.y = element_text(colour="grey", size=rel(1.6), angle=0, hjust=.5, vjust=.5, face="plain"),
    legend.text=element_text(size=rel(1.6)), 
    legend.title=element_blank(),
    legend.position = "bottom",
    panel.background = element_blank(),
    axis.line = element_line(colour = "grey"),
    strip.text = element_text(size = 17)
  )


pdf("plots/loss-dynamics.pdf",height=7, width=7)
p
dev.off()
```


### Accuracy dynamics

Reading the csv file:
```{r}
dat1 = read.csv("phylo-nn-googledrive/outputs/PlotsData/EpochAccuracy1300.csv", header=FALSE)
str(dat1)
dat = read.csv("phylo-nn-googledrive/outputs/PlotsData/SixMethodsComparison.csv", header=TRUE)
str(dat)
```

We want to do for these cases:
- c=1.0, b=1.0, a=2
```{r}
c=1
b=1
a=2

## recall switch values of a and b:
df = dat[(dat$a == b & dat$b == a & dat$c == c),]
```


```{r}
# nj, ml, bi, zou, lstm, optlstm
cols = RColorBrewer::brewer.pal(6, "YlGnBu") 

p = ggplot(dat1, aes(x=V1,y=V2))+
  geom_line(size=1, color=cols[6]) +
  geom_hline(yintercept = df$NJ, lty = 3, color=cols[1], size = 1.2) +
  geom_hline(yintercept = df$ML, lty = 3, color=cols[2], size = 1.2) +
  geom_hline(yintercept = df$BI, lty = 3, color=cols[3], size = 1.2) +
  geom_hline(yintercept = df$Zou, lty = 3, color=cols[4], size = 1.2) +
  xlab("Epoch") + ylab("Testing accuracy")+
  ylim(c(0,1.1)) +
  theme(
    plot.title = element_text(hjust=0.5, size=rel(1.6)),
    axis.title.x = element_text(size=rel(1.7)),
    axis.title.y = element_text(size=rel(1.7), angle=90, vjust=0.5, hjust=0.5),
    axis.text.x = element_text(colour="grey", size=rel(1.6), angle=0, hjust=.5, vjust=.5, face="plain"),
    axis.text.y = element_text(colour="grey", size=rel(1.6), angle=0, hjust=.5, vjust=.5, face="plain"),
    legend.text=element_text(size=rel(1.6)), 
    legend.title=element_blank(),
    legend.position = "bottom",
    panel.background = element_blank(),
    axis.line = element_line(colour = "grey"),
    strip.text = element_text(size = 17)
  )


pdf("plots/loss-dynamics.pdf",height=7, width=7)
p
dev.off()
```

- c=1.0, b=1.0, a=10
- c=1.0, b=1.0, a=40